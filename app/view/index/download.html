<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="renderer" content="webkit" />
    <meta name="force-rendering" content="webkit" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>宝塔面板安装脚本 - 一键部署</title>

    <!-- 这里保留原来的CSS引用，防止有全局依赖，但下面的内联样式会覆盖关键布局以实现现代化UI -->
    <link rel="stylesheet" type="text/css" href="/static/css/sanren.css" />
    <link rel="stylesheet" type="text/css" href="/static/css/style.css" />

    <style>
      /* =========================================
           Modern Reset & Variables
           ========================================= */
      :root {
        --primary-color: #20a53a; /* 宝塔绿 */
        --primary-hover: #188f30;
        --secondary-color: #005982; /* 科技蓝 */
        --text-main: #333333;
        --text-sub: #666666;
        --bg-body: #f5f7fa;
        --bg-card: #ffffff;
        --border-radius: 8px;
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 5px 15px rgba(0, 0, 0, 0.08);
        --code-bg: #282c34;
        --code-text: #abb2bf;
        --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: var(--font-family);
        background-color: var(--bg-body);
        color: var(--text-main);
        line-height: 1.6;
        font-size: 14px;
      }

      a {
        text-decoration: none;
        color: var(--primary-color);
        transition: 0.3s;
      }
      a:hover {
        color: var(--primary-hover);
      }

      /* =========================================
           Layout Containers
           ========================================= */
      .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 15px;
      }

      .section-spacing {
        margin-bottom: 40px;
      }

      /* =========================================
           Header
           ========================================= */
      .hero-header {
        text-align: center;
        padding: 60px 0 40px;
      }

      .hero-title {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #333;
      }

      .hero-title img {
        height: 40px;
        margin-left: 15px;
      }

      .hero-subtitle {
        font-size: 16px;
        color: var(--text-sub);
        max-width: 600px;
        margin: 0 auto;
      }

      /* =========================================
           Product Cards Grid
           ========================================= */
      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        padding: 20px 0;
      }

      .product-card {
        background: var(--bg-card);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        padding: 30px;
        text-align: center;
        transition: all 0.3s ease;
        border: 1px solid transparent;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .product-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-md);
        border-color: rgba(32, 165, 58, 0.3);
      }

      .card-icon {
        height: 80px;
        margin-bottom: 20px;
        object-fit: contain;
      }

      .card-title {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 10px;
        color: #000;
      }

      .card-desc {
        color: var(--text-sub);
        font-size: 13px;
        margin-bottom: 15px;
        min-height: 42px; /* Align heights */
      }

      .card-tags span {
        display: inline-block;
        background: #e6f7ea;
        color: var(--primary-color);
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 12px;
        margin: 0 2px;
      }

      .card-btn {
        display: block;
        width: 100%;
        padding: 10px 0;
        margin-top: 20px;
        border: 1px solid var(--primary-color);
        color: var(--primary-color);
        border-radius: 4px;
        font-weight: 600;
      }

      .card-btn:hover {
        background: var(--primary-color);
        color: #fff;
      }

      /* =========================================
           Details / Installation Sections
           ========================================= */
      .detail-section {
        background: var(--bg-card);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        padding: 40px;
        margin-bottom: 30px;
        scroll-margin-top: 20px; /* For anchor positioning */
      }

      .section-title {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 20px;
        border-left: 4px solid var(--primary-color);
        padding-left: 15px;
      }

      .intro-text {
        margin-bottom: 25px;
        font-size: 14px;
        color: var(--text-sub);
      }

      /* =========================================
           Code Blocks
           ========================================= */
      .code-group {
        margin-bottom: 20px;
      }

      .os-label {
        display: block;
        font-weight: 700;
        margin-bottom: 8px;
        color: #444;
      }

      .code-container {
        position: relative;
        background: var(--code-bg);
        border-radius: 6px;
        overflow: hidden;
        display: flex;
        align-items: stretch;
      }

      .cmd-box {
        flex: 1;
        padding: 15px;
        color: var(--code-text);
        font-family: "Consolas", "Monaco", monospace;
        font-size: 13px;
        word-break: break-all;
        border-right: 1px solid #3e4451;
        cursor: text;
        user-select: all; /* Allows easy selection */
      }

      .copy-btn {
        background: #363b45;
        color: #fff;
        border: none;
        padding: 0 20px;
        cursor: pointer;
        font-size: 13px;
        transition: background 0.2s;
        white-space: nowrap;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .copy-btn:hover {
        background: var(--primary-color);
      }

      .copy-btn:active {
        background: var(--primary-hover);
      }

      /* =========================================
           Tips & Alerts
           ========================================= */
      .alert {
        padding: 15px;
        border-radius: 4px;
        font-size: 13px;
        margin-top: 20px;
      }

      .alert-warning {
        background-color: #fffbe6;
        border: 1px solid #ffe58f;
        color: #d46b08;
      }

      .alert p {
        margin-bottom: 5px;
      }
      .alert p:last-child {
        margin-bottom: 0;
      }
      .indent {
        text-indent: 2em;
      }

      /* =========================================
           Footer
           ========================================= */
      .site-footer {
        text-align: center;
        padding: 40px 0;
        color: #999;
        font-size: 12px;
        border-top: 1px solid #eee;
        margin-top: 50px;
      }

      .footer-links a {
        color: #666;
        margin: 0 10px;
      }

      .footer-links i {
        margin: 0 5px;
        font-style: normal;
        color: #ddd;
      }

      /* =========================================
           Responsiveness
           ========================================= */
      @media (max-width: 768px) {
        .hero-title {
          font-size: 24px;
        }
        .detail-section {
          padding: 20px;
        }
        .products-grid {
          grid-template-columns: 1fr;
        }
        .code-container {
          flex-direction: column;
        }
        .cmd-box {
          border-right: none;
          border-bottom: 1px solid #3e4451;
          padding: 10px;
        }
        .copy-btn {
          padding: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- 1. 头部区域 -->
      <header class="hero-header">
        <h1 class="hero-title">
          宝塔面板安装脚本
          <img src="/static/images/i1ico_03.png" alt="BT Panel Logo" />
        </h1>
        <div class="hero-subtitle">
          <p>2分钟装好面板，一键管理服务器</p>
          <p>
            集成LAMP/LNMP环境，支持网站、FTP、数据库、文件管理、Docker等功能
          </p>
        </div>
      </header>

      <!-- 2. 核心产品选择区域 (Grid布局) -->
      <nav class="products-grid" id="product-nav">
        <!-- 这里的逻辑保持原样，处理所有选项都关闭的情况 -->
        {if config_get('linux_show')==0 && config_get('btm_show')==0 &&
        config_get('win_show')==0 && config_get('aaPanel_show')==0}
        <div class="product-card empty-card">
          <img
            class="card-icon"
            src="/static/images/prd_1_03.png"
            alt="Empty"
          />
          <h3 class="card-title">暂无可安装内容</h3>
        </div>
        {/if}

        <!-- 2.1 Linux 面板 -->
        {if config_get('linux_show')==1}
        <div class="product-card">
          <div class="card-content">
            <img
              class="card-icon"
              src="/static/images/prd_1_03.png"
              alt="Linux Panel"
            />
            <h3 class="card-title">Linux面板 {:config_get('new_version')}</h3>
            <div class="card-desc">
              Centos、Ubuntu、Debian等Linux系统。
              <a
                href="https://demo.bt.cn/login"
                target="_blank"
                rel="noopener noreferrer"
                >查看演示</a
              >
            </div>
            <div class="card-tags">
              <span>2分钟装好</span>
              <span>云厂商推荐</span>
            </div>
          </div>
          <a
            href="javascript:;"
            class="card-btn js-scroll-to"
            data-target="#install-linux"
            >查看安装脚本</a
          >
        </div>
        {/if}

        <!-- 2.2 Windows 面板 -->
        {if config_get('win_show')==1}
        <div class="product-card">
          <div class="card-content">
            <img
              class="card-icon"
              src="/static/images/prd_2_03.png"
              alt="Windows Panel"
            />
            <h3 class="card-title">
              Windows面板 {:config_get('new_version_win')}
            </h3>
            <div class="card-desc">
              Windows Server 2008 R2/2012/2016/2019/2022 64位系统
            </div>
            <div class="card-tags">
              <span>操作简单</span>
              <span>无需命令</span>
            </div>
          </div>
          <a
            href="javascript:;"
            class="card-btn js-scroll-to"
            data-target="#install-windows"
            >查看安装方法</a
          >
        </div>
        {/if}

        <!-- 2.3 云监控 -->
        {if config_get('btm_show') ==1}
        <div class="product-card">
          <div class="card-content">
            <img
              class="card-icon"
              src="/static/images/bt_monitor.png"
              alt="BT Monitor"
            />
            <h3 class="card-title">云安全监控</h3>
            <div class="card-desc">
              多机跨平台安全管理和监控系统，运维更轻松。
            </div>
          </div>
          <a
            href="javascript:;"
            class="card-btn js-scroll-to"
            data-target="#install-monitor"
            >查看安装脚本</a
          >
        </div>
        {/if}

        <!-- 2.4 aaPanel -->
        {if config_get('aaPanel_show') ==1}
        <div class="product-card">
          <div class="card-content">
            <img
              class="card-icon"
              src="/static/images/aapanel.png"
              alt="aaPanel"
            />
            <h3 class="card-title">aaPanel {:config_get('new_version_en')}</h3>
            <div class="card-desc">宝塔面板国际版 (International Version)</div>
          </div>
          <a
            href="javascript:;"
            class="card-btn js-scroll-to"
            data-target="#install-aapanel"
            >View Script</a
          >
        </div>
        {/if}
      </nav>

      <!-- 3. 详细安装指南区域 -->
      <main>
        <!-- 3.1 Linux Guide -->
        {if config_get('linux_show')==1}
        <section id="install-linux" class="detail-section">
          <h2 class="section-title">
            Linux面板 {:config_get('new_version')} 安装脚本
          </h2>
          <p class="intro-text">
            使用 SSH 连接工具（如
            <a
              href="https://www.putty.org/"
              target="_blank"
              rel="noopener noreferrer"
              >PUTTY</a
            >）连接服务器，<a
              href="https://www.bt.cn/bbs/thread-50002-1-1.html"
              target="_blank"
              >挂载磁盘</a
            >
            后执行相关命令。
          </p>

          <!-- Code Block: Centos -->
          <div class="code-group">
            <span class="os-label">Centos 安装脚本</span>
            <div class="code-container">
              <div class="cmd-box">
                yum install -y wget && wget -O install.sh
                {$siteurl}/install/install_panel.sh && sh install.sh
              </div>
              <button
                class="copy-btn"
                data-clipboard-text="yum install -y wget && wget -O install.sh {$siteurl}/install/install_panel.sh && sh install.sh"
              >
                复制命令
              </button>
            </div>
          </div>

          <!-- Code Block: Ubuntu/Debian -->
          <div class="code-group">
            <span class="os-label">Ubuntu/Debian 安装脚本</span>
            <div class="code-container">
              <div class="cmd-box">
                wget -O install.sh {$siteurl}/install/install_panel.sh && bash
                install.sh
              </div>
              <button
                class="copy-btn"
                data-clipboard-text="wget -O install.sh {$siteurl}/install/install_panel.sh && bash install.sh"
              >
                复制命令
              </button>
            </div>
          </div>

          <!-- Code Block: Update -->
          <div class="code-group">
            <span class="os-label">一键更新脚本</span>
            <div class="code-container">
              <div class="cmd-box">curl {$siteurl}/install/update6.sh|bash</div>
              <button
                class="copy-btn"
                data-clipboard-text="curl {$siteurl}/install/update6.sh|bash"
              >
                复制命令
              </button>
            </div>
          </div>

          <div class="alert alert-warning">
            <p><strong>注意：</strong></p>
            <p>
              1. 必须为没装过其它环境(Apache/Nginx/php/MySQL)的新系统，推荐使用
              Centos 7.X。
            </p>
            <p>2. 推荐使用 Chrome、Firefox、Edge 浏览器访问面板。</p>
            <p>3. 如需从第三方版本切换到官方版，直接执行更新脚本即可。</p>
          </div>
        </section>
        {/if}

        <!-- 3.2 Windows Guide -->
        {if config_get('win_show')==1}
        <section id="install-windows" class="detail-section">
          <h2 class="section-title">
            Windows面板 {:config_get('new_version_win')} 安装方法
          </h2>

          <div class="intro-text">
            <p>
              1、下载
              <a
                href="https://download.bt.cn/win/panel/go/BtSoft.exe"
                target="_blank"
                rel="noopener noreferrer"
                >官方安装程序</a
              >
              进行安装（安装完先不要进入面板）。
            </p>
            <p>2、在命令提示符（CMD）输入下方命令进行更新并重启面板。</p>
            <p>3、打开面板后，绑定账号时输入任意账号密码即可。</p>
          </div>

          <div class="code-group">
            <span class="os-label">一键更新/安装辅助命令</span>
            <div class="code-container">
              <div class="cmd-box">
                wget {$siteurl}/win/install/panel_update.py -O C:/update.py &&
                "C:\Program Files\python\python.exe" C:/update.py
                {:config_get('new_version_win')}
              </div>
              <!-- PHP escape issues handled by single quotes logic if needed, ensuring safe output -->
              <button
                class="copy-btn"
                data-clipboard-text='wget {$siteurl}/win/install/panel_update.py -O C:/update.py && "C:\Program Files\python\python.exe" C:/update.py {:config_get("new_version_win")}'
              >
                复制命令
              </button>
            </div>
          </div>

          <div class="alert alert-warning">
            <p>
              <strong>注意：</strong>支持 Windows Server 2012/Windows 8
              及以上系统，且未安装其它环境。
            </p>
          </div>
        </section>
        {/if}

        <!-- 3.3 Monitor Guide -->
        {if config_get('btm_show')==1}
        <section id="install-monitor" class="detail-section">
          <h2 class="section-title">
            云安全监控 {:config_get('new_version_btm')} 安装脚本
          </h2>
          <p class="intro-text">连接服务器 SSH 后执行命令：</p>

          <div class="code-group">
            <span class="os-label">安装脚本</span>
            <div class="code-container">
              <div class="cmd-box">
                curl -sS {$siteurl}/install/install_btmonitor.sh -o
                /tmp/install_btmonitor.sh && bash /tmp/install_btmonitor.sh
              </div>
              <button
                class="copy-btn"
                data-clipboard-text="curl -sS {$siteurl}/install/install_btmonitor.sh -o /tmp/install_btmonitor.sh && bash /tmp/install_btmonitor.sh"
              >
                复制命令
              </button>
            </div>
          </div>

          <div class="code-group">
            <span class="os-label">更新脚本</span>
            <div class="code-container">
              <div class="cmd-box">
                curl {$siteurl}/install/update_btmonitor.sh|bash
              </div>
              <button
                class="copy-btn"
                data-clipboard-text="curl {$siteurl}/install/update_btmonitor.sh|bash"
              >
                复制命令
              </button>
            </div>
          </div>
        </section>
        {/if}

        <!-- 3.4 Cloud WAF Guide (Merged Fix) -->
        {if config_get('btwaf_show')==1}
        <section id="install-waf" class="detail-section">
          <h2 class="section-title">
            云WAF {:config_get('waf_new_version')} 安装脚本
          </h2>
          <p class="intro-text">连接服务器 SSH 后执行命令（约2分钟完成）：</p>

          <div class="code-group">
            <span class="os-label">单机版脚本</span>
            <div class="code-container">
              <div class="cmd-box">
                URL=https://download.bt.cn/cloudwaf/scripts/install_cloudwaf.sh
                && if [ -f /usr/bin/curl ];then curl -sSO "$URL";else wget -O
                install_cloudwaf.sh "$URL";fi;bash install_cloudwaf.sh
              </div>
              <button
                class="copy-btn"
                data-clipboard-text='URL=https://download.bt.cn/cloudwaf/scripts/install_cloudwaf.sh && if [ -f /usr/bin/curl ];then curl -sSO "$URL";else wget -O install_cloudwaf.sh "$URL";fi;bash install_cloudwaf.sh'
              >
                复制命令
              </button>
            </div>
          </div>

          <div class="code-group">
            <span class="os-label">集群版脚本</span>
            <div class="code-container">
              <div class="cmd-box">
                URL=https://download.bt.cn/cloudwaf/scripts/install_waf_master.sh
                && if [ -f /usr/bin/curl ];then curl -sSO "$URL" ;else wget -O
                install_waf_master.sh "$URL";fi;bash install_waf_master.sh
              </div>
              <button
                class="copy-btn"
                data-clipboard-text='URL=https://download.bt.cn/cloudwaf/scripts/install_waf_master.sh && if [ -f /usr/bin/curl ];then curl -sSO "$URL" ;else wget -O install_waf_master.sh "$URL";fi;bash install_waf_master.sh'
              >
                复制命令
              </button>
            </div>
          </div>

          <div class="alert alert-warning">
            <p><strong>互斥提示：</strong></p>
            <p>
              已安装宝塔面板的机器，请勿安装云WAF（直接在面板内安装Nginx防火墙插件即可）。云WAF需要独立服务器部署。
            </p>
          </div>
        </section>
        {/if}

        <!-- 3.5 aaPanel Guide -->
        {if config_get('aaPanel_show') ==1 }
        <section id="install-aapanel" class="detail-section">
          <h2 class="section-title">
            aaPanel {:config_get('new_version_en')} Install Script
          </h2>
          <p class="intro-text">Recommended OS: Ubuntu 22.04</p>

          <div class="code-group">
            <span class="os-label">Install Script</span>
            <div class="code-container">
              <div class="cmd-box">
                URL={$siteurl}/install/install_7.0_en.sh && if [ -f
                /usr/bin/curl ];then curl -ksSO $URL ;else wget -O
                install_7.0_en.sh $URL;fi;bash install_7.0_en.sh
              </div>
              <button
                class="copy-btn"
                data-clipboard-text="URL={$siteurl}/install/install_7.0_en.sh && if [ -f /usr/bin/curl ];then curl -ksSO $URL ;else wget -O install_7.0_en.sh $URL;fi;bash install_7.0_en.sh"
              >
                Copy
              </button>
            </div>
          </div>

          <div class="code-group">
            <span class="os-label">Upgrade Script</span>
            <div class="code-container">
              <div class="cmd-box">
                curl {$siteurl}/install/update_7.x_en.sh|bash
              </div>
              <button
                class="copy-btn"
                data-clipboard-text="curl {$siteurl}/install/update_7.x_en.sh|bash"
              >
                Copy
              </button>
            </div>
          </div>
        </section>
        {/if}
      </main>

      <!-- Footer -->
      <footer class="site-footer">
        <div class="footer-links">
          <a href="http://www.bt.cn/new/agreement_open.html" target="_blank"
            >开源许可协议</a
          ><i>|</i>
          <a href="http://www.bt.cn/new/agreement_user.html" target="_blank"
            >用户协议</a
          ><i>|</i>
          <a href="http://www.bt.cn/new/agreement_privacy.html" target="_blank"
            >隐私声明</a
          >
        </div>
        <p style="margin-top: 10px">
          Copyright © {:date('Y')} 宝塔面板安装脚本
        </p>
      </footer>
    </div>

    <!-- Scripts -->
    <script src="{$cdnpublic}jquery/3.6.0/jquery.min.js"></script>
    <script src="{$cdnpublic}layer/3.5.1/layer.js"></script>
    <script src="{$cdnpublic}clipboard.js/1.7.1/clipboard.min.js"></script>
    <script src="/static/js/dx.js"></script>

    <script>
      $(document).ready(function () {
        // 1. 初始化 ClipboardJS
        // 使用更具体的选择器，并优化获取逻辑
        var clipboard = new Clipboard(".copy-btn", {
          text: function (trigger) {
            // 优先获取 data 属性，如果为空则尝试获取同级 .cmd-box 的文本
            var text = trigger.getAttribute("data-clipboard-text");
            if (!text) {
              text = $(trigger).siblings(".cmd-box").text().trim();
            }
            return text;
          },
        });

        clipboard.on("success", function (e) {
          // 使用 layer 提示，更友好
          layer.msg("复制成功，请在终端粘贴", { icon: 1, time: 2000 });
          e.clearSelection();
        });

        clipboard.on("error", function (e) {
          layer.msg("复制失败，请手动复制", { icon: 2 });
        });

        // 2. 点击命令框也触发复制（用户体验优化）
        $(".cmd-box").click(function () {
          $(this).siblings(".copy-btn").click();
        });

        // 3. 平滑滚动逻辑 (通用的事件代理)
        $(".js-scroll-to").click(function (e) {
          e.preventDefault(); // 阻止可能的默认锚点跳转行为
          var targetSelector = $(this).data("target");
          var $target = $(targetSelector);

          if ($target.length) {
            $("html, body").animate(
              {
                scrollTop: $target.offset().top - 20, // 留20px顶部间距
              },
              500
            );
          }
        });

        // 4. 处理 URL 参数自动定位
        function getQueryString(name) {
          // 修复：unescape 已弃用，改用 decodeURIComponent
          // 逻辑：处理仅有 ?bt 无值的情况
          var search = window.location.search.substring(1);
          if (search === name) return name;

          var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
          var r = search.match(reg);
          if (r != null) {
            try {
              // 尝试使用标准解码，失败则回退或直接返回
              return decodeURIComponent(r[2]);
            } catch (e) {
              return unescape(r[2]);
            }
          }
          return null;
        }

        // 检查是否需要自动滚动
        if (getQueryString("bt")) {
          // 稍微延迟以确保DOM渲染完毕
          setTimeout(function () {
            var $target = $("#install-linux");
            if ($target.length) {
              $("html, body").animate(
                { scrollTop: $target.offset().top - 20 },
                500
              );
            }
          }, 100);
        }
      });
    </script>
  </body>
</html>
